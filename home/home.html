<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="shortcut icon" href="./Immagini/favicon.png">
  <link rel="stylesheet" href="home.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://icons8.com/icon/7801/up" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

  <title>MyShoppingList</title>

    <script>
        window.addEventListener('load', function (event) {
            console.log(sessionStorage.getItem("Log"));
            console.log(sessionStorage.getItem("email"));
            console.log(sessionStorage.getItem("sessionId"));
            if (sessionStorage.getItem("Log") != 1 && sessionStorage.getItem("sessionId")==null) {
                $.ajax({
                    url: "check_login.php",
                    type: "POST",
                    data: {
                        cestino: 1
                    },
                    success: function (data) {
                        console.log('Richiesta andata a buon fine.');
                        setSessionCookie();
                    },
                    error: function (xhr, status, error) {
                        // Gestisci gli errori durante la chiamata AJAX
                        console.error('Si è verificato un errore durante la richiesta.');
                    }
                })
            }
        });
    </script>

    <!-- Check del Login -->
    <script>
        $(document).ready(function(){
            // Gestisci il submit del form di login
            $('.login form').submit(function(event){
                // Evita il comportamento predefinito del form (ricaricamento della pagina)
                event.preventDefault();

                // Ottieni i valori inseriti dall'utente nei campi email e password
                var email = $(this).find('input[type="email"]').val();
                var pass = $(this).find('input[type="password"]').val();

                // Esegui una chiamata AJAX per controllare le credenziali nel database
                $.ajax({
                    url: 'check_login.php', // URL del file PHP che esegue la query al database
                    type: 'POST',
                    data: { email: email, pass: pass },
                    success: function(response){
                        // Se la risposta è 'success', l'utente esiste nel database
                        console.log(response)
                        if(response.trim() === 'success'){
                            // Reindirizza l'utente alla sua pagina utente
                            window.location.href = '../User_Page/user.html';
                            sessionStorage.setItem("Log",1);
                            sessionStorage.setItem("email",email);
                            // $.ajax({
                            //     url: "check_login.php",
                            //     type: "POST",
                            //     data: {
                            //         cestino: 1
                            //     },
                            //     success: function (data) {
                            //         console.log('Richiesta andata a buon fine.');
                            //     },
                            //     error: function (xhr, status, error) {
                            //         // Gestisci gli errori durante la chiamata AJAX
                            //         console.error('Si è verificato un errore durante la richiesta.');
                            //     }
                            // })
                        } else {
                            Swal.fire({
                                title: "Errore!",
                                html: "Invalid credentials. <br>Try again.",
                                icon: "error",
                                dangerMode: true,
                                background: "#f8f9fa",
                                textColor: "#343a40",
                                width: "400px",
                                padding: "3rem",
                                titleFont: "Montserrat_Arabic_Regular",
                                textFont: "Montserrat_Arabic_Regular",
                                showConfirmButton: false, // Nasconde il pulsante "OK"
                                timer: 2000 // Tempo in millisecondi (3 secondi)
                            });
                        }
                    },
                    error: function(xhr, status, error){
                        // Gestisci gli errori durante la chiamata AJAX
                        console.error('Si è verificato un errore durante la richiesta.');
                    }
                });
            });
        });
    </script>

    <!-- Popup Login -->
    <script>
        window.addEventListener('load', function (event) {
        if (sessionStorage.getItem("Log") == 1) {
            // Se l'utente è già loggato, reindirizza alla pagina utente
            document.querySelector('.Btn').addEventListener('click', function () {
                window.location.href = '../User_Page/user.html';
                wrapper.classList.remove('active-popup');
                body.classList.remove('popup-active');
            });
            } else {
                // Se l'utente non è loggato, mostra il popup di login
                const wrapper = document.querySelector('.wrapper');
                const body = document.querySelector('body');
                const loginLink = document.querySelector('.login-link');
                const iconClose = document.querySelector('.icon-close');
                const btnPopup = document.querySelector('.Btn');

                loginLink.addEventListener('click', () => {
                    wrapper.classList.remove('active');
                });

                btnPopup.addEventListener('click', () => {
                    wrapper.classList.add('active-popup');
                    body.classList.add('popup-active');
                });

                iconClose.addEventListener('click', () => {
                    wrapper.classList.remove('active-popup');
                    body.classList.remove('popup-active');
                    hidePopup();
                });
            }
        });
    </script>

    <!-- Cambia immagine Navbar -->
    <script>
        window.addEventListener('load', function (event) {
            if(sessionStorage.getItem("Log")==1){
                var email=sessionStorage.getItem("email");
                $.ajax({
                    url: "check_login.php",
                    type: "GET",
                    data:{
                        email: email
                    },
                    dataType:'json',
                    success: function(data){
                        data.forEach(function (element) {

                            var name_img = element.nome;

                            function primaLetteraMaiuscola(parola) {
                                var primaLettera = parola.charAt(0);
                                return primaLettera.toUpperCase();
                            }

                            name_img = primaLetteraMaiuscola(name_img);

                            // Trova l'elemento ion-icon all'interno del pulsante
                            const iconElement = document.querySelector('.Btn ion-icon');

                            // Rimuovi l'elemento ion-icon
                            iconElement.remove();

                            // Crea un nuovo elemento immagine
                            const imgElement = document.createElement('h3');

                            // Assegna il testo della variabile name_img all'elemento h2
                            imgElement.textContent = name_img;

                            imgElement.style.color = 'white';
                            imgElement.style.margin = 'auto'
                            imgElement.style.fontWeight = '700';

                            // Aggiungi l'immagine al div con la classe "sign"
                            const signDiv = document.querySelector('.Btn .sign');
                            signDiv.appendChild(imgElement);

                            // Seleziona l'elemento del pulsante
                            const loginButton = document.querySelector('.text_btn');

                            // Cambia il testo del pulsante a "Accedi"
                            loginButton.textContent = 'Profile';

                        });
                    },
                    error: function(xhr, status, error){
                        // Gestisci gli errori durante la chiamata AJAX
                        console.error('Si è verificato un errore durante la richiesta.');
                    }
                })
            }
        });
    </script>

    <!-- Script per la generazione di un session ID casuale -->
    <script>
        // Function to generate a random session ID
        function generateSessionId() {
            // Characters to be used in the session ID
            var characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';

            // Length of the session ID
            var length = 10;

            var sessionId = '';
            for (var i = 0; i < length; i++) {
                // Generate a random index to select a character from the characters string
                var randomIndex = Math.floor(Math.random() * characters.length);
                
                // Append the randomly selected character to the session ID
                sessionId += characters.charAt(randomIndex);
            }
            
            return sessionId;
        }


        // Function to set a session ID cookie
        function setSessionCookie() {
            // Check if session ID is already set
            if (sessionStorage.getItem('sessionId')) {
                // Session ID is already set
                var sessionId = sessionStorage.getItem('sessionId');
                console.log('Session ID is already set: ' + sessionId);
                return;
            }

            // Generate a session ID
            var sessionId = generateSessionId();

            sessionStorage.setItem('sessionId', sessionId); // Assuming sessionId is the variable holding the generated session ID
        }

        // Call function to set session cookie
        // $(document).ready(function(){
        //     setSessionCookie();
        // })
    </script>

</head>

<body>

    <div class="overlay"></div>


    <!-- NavBar -->
    <div>
        <header class="header">
            <a href="home.html"><img src="./Immagini/MyShoppingList.png" class="logo"></a>
            <nav class="my_navbar">
                    <a href="home.html" class="link_navbar">Home</a>
                    <a href="#contatti">Contacts</a>
                    <a href="#contatti" class="icon_contatti"><img src="./Immagini/phone.png"></a>
                    <a href="#">        
                        <button class="Btn">
                        <div class="sign"><ion-icon name="person-circle-outline" size="large"></ion-icon></div>
                        <div class="text_btn">Login</div>
                        </button>
                    </a>
            </nav>
        </header>
    </div>

    <!--Login e Signin-->
    <div class="wrapper">
        <span class="icon-close">
            <ion-icon name="close-outline"></ion-icon>
        </span>

        <div class="form-box login">
            <h2>Login</h2>
            <form action="#" method="post">
                <div class="input-box">
                    <span class="icon"><ion-icon name="mail-outline"></ion-icon></span>
                    <input type="email" required>
                    <label>Email</label>
                </div>
                <div class="input-box">
                    <span class="icon"><ion-icon name="lock-closed-outline"></ion-icon></span>
                    <input type="password" required>
                    <label>Password</label>
                </div>
                <button type="submit" class="btn">Login</button>
                <div class="login-register">
                    <p>Don't have an account?<a href="../User_Page/user.html" class="register-link"> Register</a></p>
                </div>
            </form>
        </div>

        <div class="form-box register">
            <h2>Registration</h2>
            <form action="#">
                <div class="input-box">
                    <span class="icon"><ion-icon name="person-outline"></ion-icon></span>
                    <input type="text" required>
                    <label>Username</label>
                </div>
                <div class="input-box">
                    <span class="icon"><ion-icon name="mail-outline"></ion-icon></span>
                    <input type="email" required>
                    <label>Email</label>  
                </div>
                <div class="input-box">
                    <span class="icon"><ion-icon name="lock-closed-outline"></ion-icon></span>
                    <input type="password" required>
                    <label>Password</label>
                </div>
                <div class="remember-forgot">
                    <label><input type="checkbox">agree to the terms & conditions</label>
                </div>
                <button type="submit" class="btn">Register</button>
                <div class="login-register">
                    <p>Already have an account?<a href="#" class="login-link">Login</a></p>
                </div>
            </form>
        </div>
    </div>

    <div class="container_slogan">
        <!-- Container Slogan, Background e Pulsante Shopping -->
        <img class="showing background" src="./Immagini/food9.png">
        <img class="background" src="./Immagini/food3.jpg">
        <img class="background" src="./Immagini/food5.jpg">
        <img class="background" src="./Immagini/food7.png">
        <img class="background" src="./Immagini/food8.png">
        <img class="background" src="./Immagini/food6.png">
        <img class="background" src="./Immagini/food10.png">
        <img class="background" src="./Immagini/food11.png">
        <img class="background" src="./Immagini/food12.png">
        
        <div class="text_slogan_container">
            <div class="text_slogan lineUp">The easier way <br> to save money <br> and eat healthy.</div>
            <div><br></div>
            <div class="shopping_container">
                <button class="button_shopping lineUp" onclick="window.location.href='../search_products/search_products.html';" >Fill the cart now ➜</button>
            </div>
        </div>

    </div>

    <!-- Obiettivi -->
    <div class="obiettivi_container">
        <div> 
            <div class="obiettivi obiettivi1"></div>
            <div class="text_obiettivi_sansserif">Convenience</div>
            <div class="text_obiettivi_serif"> We always find <br> the lowest price</div>
        </div>

        <div>
            <div class="obiettivi obiettivi2"></div>
            <div class="text_obiettivi_sansserif"> Health </div>
            <div class="text_obiettivi_serif">We choose the best <br>products</div>
        </div>

        <div>
            <div class="obiettivi obiettivi3"></div>
            <div class="text_obiettivi_sansserif"> Position </div>
            <div class="text_obiettivi_serif">A stone's throw <br> from home</div>
        </div>
    </div>

    <!-- Spiegazioni -->
    <div class="spiegazioni">
        <section class="spiegazioni_container">
            <div class="image-container_sopra">
                <img src="./Immagini/gif2.gif" alt="Immagine">
            </div>
        
            <div class="text-container">
                <h1>How do we help you?</h1>
                <br>
                <p class="text_spiegazioni_serif">Our goal is to simplify the lives of all the people who don't know which supermarket to go to to find the best prices and quality they want.</p>
                <p class="text_spiegazioni_serif">Simply search for all the products you want, add them to the cart, and as soon as it is completed we will immediately be able to indicate which supermarket to go to based on the cheapest price and location.</p>
            </div>
        </section>

        <section class="spiegazioni_container">
            <div class="text-container">
                <h1>Tailored for you!</h1>
                <br>
                <p class="text_spiegazioni_serif">Furthermore, by filling out a form that we administer to all users who want to register, we will also be able to indicate which product is best for the user, based on the preferences indicated and the lifestyle they have chosen.</p>
                </div>

            <div class="image-container_sotto">
                <img src="./Immagini/gif (1).gif" alt="Immagine">
            </div>
        </section>
    </div>

    <!-- SuperMercati  e Marche-->
    <div class="text_supermercati">
        <p>From the best supermarkets...</p>
    </div>

    <div class="griglia">
        <div class="colonna">
            <img src="./Immagini/Carrefour.svg">
        </div>
        <div class="colonna">
            <img src="./Immagini/Coop.svg">
        </div>
        <div class="colonna">
            <img src="./Immagini/Esselunga.svg">
        </div>
        <div class="colonna">
            <img src="./Immagini/Conad.svg">
        </div>
        <div class="colonna">
            <img src="./Immagini/Todis.svg">
        </div>
    </div>

    <div class="text_prodotti">
        <p>...to the best products</p>
    </div>

    <div class="logos">
        <div class="logos_slide">
            <img src="./Immagini/Nutella.svg">
            <img src="./Immagini/Barilla.svg">
            <img src="./Immagini/rio_mare.png">
            <img src="./Immagini/Kinder.svg">
            <img src="./Immagini/mulino_bianco.png">
            <img src="./Immagini/Heineken.svg">
            <img src="./Immagini/Grana_Padano.svg">
            <img src="./Immagini/durex.png">
            <img src="./Immagini/san-carlo-seeklogo.svg">
            <img src="./Immagini/Coca_Cola.svg">
            <img src="./Immagini/Lays.png">
            <img src="./Immagini/Nestlé.svg">
        </div>
            <div class="logos_slide">
            <img src="./Immagini/Nutella.svg">
            <img src="./Immagini/Barilla.svg">
            <img src="./Immagini/rio_mare.png">
            <img src="./Immagini/Kinder.svg">
            <img src="./Immagini/mulino_bianco.png">
            <img src="./Immagini/Heineken.svg">
            <img src="./Immagini/Grana_Padano.svg">
            <img src="./Immagini/durex.svg">
            <img src="./Immagini/san-carlo-seeklogo.svg">
            <img src="./Immagini/Coca_Cola.svg">
            <img src="./Immagini/Lays.png">
            <img src="./Immagini/Nestlé.svg">
        </div>
    </div>

    <!-- Back To Top -->
    <a href="#" id="back-to-top-btn" class="back_to_top">
        <span>
        <img src="./Immagini/arrow_up.png">
        </span>
    </a>

    <!-- Footer -->
    <div class="footer_container">
        <div class="social_container">
            <div class="wrapper_social">

                <a href="https://www.facebook.com/" class="icon facebook">
                    <span><i class="fab fa-facebook-f"></i></span>
                </a>

                <a href="https://www.instagram.com/" class="icon instagram">
                    <span><i class="fab fa-instagram"></i></span>
                </a>

                <a href="https://github.com/damspada/MyShoppingList" class="icon github">
                    <span><i class="fab fa-github"></i></span>
                </a>

                <a href="https://it.linkedin.com/" class="icon linkedin">
                    <span><i class="fab fa-linkedin"></i></span>
                </a>

                <a href="https://www.youtube.com/" class="icon youtube">
                    <span><i class="fab fa-youtube"></i></span>
                </a>
            </div>
        </div>

        <div class="contatti" id="contatti">
            <div class="contatto">
                <p><img src="./Immagini/phone.png">+39 340-559-5344</p>
            </div>
            
            <div class="contatto">
                <p><img src="./Immagini/mail.png"><a href="mailto:MyShoppingList@gmail.com">MyShoppingList@gmail.com</a></p>
            </div>
        </div>

    </div>
   
<script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/2.1.2/sweetalert.min.js"></script>
</body>

<script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
<script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
<script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
<script src="home.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

</html>